package com.softwareverde.bitcoin.server.message.type.query.response.block.merkle;

import com.softwareverde.bitcoin.block.BlockInflater;
import com.softwareverde.bitcoin.block.MutableBlock;
import com.softwareverde.bitcoin.block.merkleroot.PartialMerkleTree;
import com.softwareverde.bitcoin.bloomfilter.BloomFilterInflater;
import com.softwareverde.bitcoin.hash.sha256.Sha256Hash;
import com.softwareverde.bitcoin.transaction.script.ScriptBuilder;
import com.softwareverde.bitcoin.transaction.script.opcode.Operation;
import com.softwareverde.bitcoin.transaction.script.opcode.PushOperation;
import com.softwareverde.bloomfilter.BloomFilter;
import com.softwareverde.constable.bytearray.MutableByteArray;
import com.softwareverde.constable.list.List;
import com.softwareverde.util.HexUtil;
import com.softwareverde.util.Util;
import org.junit.Assert;
import org.junit.Test;

public class MerkleInflaterTests {
    @Test
    public void should_inflate_merkle_block_from_bitcoinj() {
        final String merkleBlockBytesString = "E3E1F3E86D65726B6C65626C6F636B0058010000F9F75FF7" + "0100000006E533FD1ADA86391F3F6C343204B0D278D4AAEC1C0B20AA27BA0300000000006ABBB3EB3D733A9FE18967FD7D4C117E4CCBBAC5BEC4D910D900B3AE0793E77F54241B4D4C86041B4089CC9B0C000000084C30B63CFCDC2D35E3329421B9805EF0C6565D35381CA857762EA0B3A5A128BBCA5065FF9617CBCBA45EB23726DF6498A9B9CAFED4F54CBAB9D227B0035DDEFBBB15AC1D57D0182AAEE61C74743A9C4F785895E563909BAFEC45C9A2B0FF3181D77706BE8B1DCC91112EADA86D424E2D0A8907C3488B6E44FDA5A74A25CBC7D6BB4FA04245F4AC8A1A571D5537EAC24ADCA1454D65EDA446055479AF6C6D4DD3C9AB658448C10B6921B7A4CE3021EB22ED6BB6A7FDE1E5BCC4B1DB6615C6ABC5CA042127BFAF9F44EBCE29CB29C6DF9D05B47F35B2EDFF4F0064B578AB741FA78276222651209FE1A2C4C0FA1C58510AEC8B090DD1EB1F82F9D261B8273B525B02FF1A";
        final MerkleBlockMessageInflater merkleBlockMessageInflater = new MerkleBlockMessageInflater();

        final MerkleBlockMessage inflatedMerkleBlockMessage = merkleBlockMessageInflater.fromBytes(HexUtil.hexStringToByteArray(merkleBlockBytesString));

        final MerkleBlockMessage merkleBlockMessage = new MerkleBlockMessage();
        merkleBlockMessage.setBlockHeader(inflatedMerkleBlockMessage.getBlockHeader());
        merkleBlockMessage.setPartialMerkleTree(inflatedMerkleBlockMessage.getPartialMerkleTree());

        Assert.assertEquals(inflatedMerkleBlockMessage.getPartialMerkleTree().getFlags(), merkleBlockMessage.getPartialMerkleTree().getFlags());
        final PartialMerkleTree inflatedPartialMerkleTree = inflatedMerkleBlockMessage.getPartialMerkleTree();
        final List<Sha256Hash> inflatedPartialMerkleTreeHashes = inflatedPartialMerkleTree.getHashes();

        int i = 0;
        for (final Sha256Hash hash : inflatedPartialMerkleTreeHashes) {
            Assert.assertEquals(hash, merkleBlockMessage.getPartialMerkleTree().getHashes().get(i));
            i += 1;
        }

        Assert.assertEquals(MutableByteArray.wrap(HexUtil.hexStringToByteArray(merkleBlockBytesString)), merkleBlockMessage.getBytes());
    }

    @Test
    public void should_inflate_bitoinj_bloom_filter_and_serve_matched_merkle_block() {
        final BloomFilterInflater bloomFilterInflater = new BloomFilterInflater();
        final BlockInflater blockInflater = new BlockInflater();
        // Block 0000000000000000019A726683D642E8981228E33D79E868E0BE0E4AEA70BCB8
        final MutableBlock block = blockInflater.fromBytes(HexUtil.hexStringToByteArray("0000002058A8F39CAFA34195E47835C9B2EF37C18CD69842C056D402000000000000000064D8167C7B3524CD686BD0C90B1BAACF0BC2C8A4C33ED458216A611E89CAC40B546EAE5C373F031833239C110F01000000010000000000000000000000000000000000000000000000000000000000000000FFFFFFFF2703A4D0081A4D696E656420627920416E74506F6F6C330101370020A919DE0AC8CD0200EBB70300FFFFFFFF03DDE7814A000000001976A9141FEFE863A7E0DDC767780CE3BEDC564CF5CBDA6388ACA40E0000000000001976A914000000000000000000000000000000000000000088AC0000000000000000266A24AA21A9ED259E7E332BDB4F006D153A8A620C6810D3D0ED6B004C636B47084711C27041650000000001000000026503C1A95DB440D70DE142C914951F98BA93F315DF518F6D3B0001F480085493000000006B483045022100BED85F0857747FB57D2B5E52A237463E553ABDCD786D4A332D2179CE1A744E5E02205BD432358B8E24D54EBD4A78E33DA6802C77C230CC602DBFBA9BBEE9606875C9412102A1A1DF951B1B2D77EF6C1837850CC1657A0DFB3BEB1292F3DC055F2F172F7F96FEFFFFFFF3DB3B1622E7085587F6F8BC208A961F2E912C9213C487AC51437ACB42D154AC000000006B483045022100BC95C1EA3B1D09010C4B69B57C95B81DF4E490EF15DCCD5EA9ABE67F12ED3957022046D132372B4F6D47F2CCCF28D8390159B96901214B4D42BFA48B3BCCBA2AA7CE4121034F3721DD7AED3C917D27BBABC4955ACD3A632C4BA738AAE7775B29EFADDD4308FEFFFFFF0241420F00000000001976A91408ADE423F438BE01C343FD901CE5330BC4F37AB388AC80969800000000001976A9146016364B8E25450CCC70B04906B35C4B5864B97588ACA3D008000100000002066E55D04F57AF8C1B165EFCB9B6E2A0C227CF0D94578F5DE3F85F8C3F306038020000006A4730440220209DD5690F45AAFD97F0B278115CD7E485C5D8347FE043BF6CFD819EDFF3469B022053D903C6381B5B12D81790E0758961189F445BD2E21A63C622BE80AEEF7D4A23412102314CC9B45D785A4242C9A10480B96F5DBA3228D3CBD77AA1A528070822EA4B7CFFFFFFFF57A181F64CCB8112B9E4D088591BDADA122FAF5E0BF1F3B4C263B2124AA729C5000000006B483045022100842C9247E29B572404E285B0B426B18A1ED89A46AB1EEFBFEC8FA8F37B293540022057E36D7055B4431E75C59BE7F63838F585A927A19C047448C1AAA1E4166AD3EB4121032B683CE15C0315C00B0B2A7945C46F03795F9154AA8D26EAE44A0461150EF4E9FFFFFFFF0222020000000000001976A914C100377D35840DC98880A1C9A72DA5A16CD8BFF888AC129B0700000000001976A914D6893644E6B17582F42ADFA5D9C48B49F979937788AC000000000100000001588F8E5962F386DF5849E57231E90ED83DC6F4771FCA9F15D3F2E681453E0A20000000006A4730440220015878041D41A0A7136FB25FCD545D9CDDB39FF3DE61341EEE3E5C6F09E7FF3C02200CC389407CD8167685909B966267B1532B2275801E5FA426D9388263E67900F8412103DF29FD7B3BFA42A0C410645ED6F1914F4340EA4C9B35E0E6E2D9781F0E4887FDFFFFFFFF0262060000000000001976A914D14334B9B339BE0550E632F22FA7821263E3491088AC00E54300000000001976A9143E96740DDF068BC65FDC290F4226547503E9BBBB88AC000000000200000002BE3B132EC6CD15D120CD170050C6889562EA577637191BFCD55AFBE9A376766A010000006B48304502210099F179C5A0EFCA9C864EABF14DEE1456A3D8B06D920DC7E21116AEC24741F3EC02201EC700EADE620ED207D457D1C6A5E1C94F377BC19C786D8E2968B1B6A42E4CBB412102DF413546C5730E5E0CE72F69CA814FA74E66D3145A96DC522A5407E7A964AF75FEFFFFFFB92F32F945D2099ED35EFC96AC52DA480DF938C00688932303E53DAFDB88F0DE010000006A47304402202BDB2B4798D60DEB7580303F708DA8E21C7D41618CB7572D1B4FA0C2049BECF302203D90AF1E5E7DC01CE8D5B24C11FA5F4D9FBB4C4432DA97A6645AA0C7414C13EB41210346AAAD48BEAEA7F05C74C3E05D1E032C9F40CDA18EF037667DEE17C42E9F889DFEFFFFFF0237270D5C000000001976A914FA2D87C83D7A7D88D6CBFEE163CD4EC0913FFF6888AC008589DC000000001976A91411370EE9BA18D2FA8BDF0E72F04D456BE5CC319C88ACA3D0080001000000018E0C24F7E55B2D985BFB65CF0CBF7DF5B5D14E483DCA082B9B8F658D92F2FA30010000006B48304502210098B12142CB500B0CE4481076ED3D4804727803C6587927D3FFDCCC39C06E1C6D02201AC474C2E13BD9AA1CA422EDE30609C3015A6EC0804C8BB8DBC5F506380C6B3641210343EF87DCDA0DA6665F6092F9807164D5077069FA8D4825C071ACEB122F6A9748FFFFFFFF02097E2C00000000001976A914B9C808F719654B5EFD25A37CD02F2BBBCF016AA688AC94030000000000001976A91491B42BF3A05C268051AC601A01F99729D1FD40DA88AC000000000100000001E676918ECB9C187233377CDCFFE423B532F04E8D0006A509707DEA18822AB246000000006A4730440220573B4ABFFB14968D5BFBEEF1208797FB612FEDD50C8E1D339BEA4E8271ABC1C702203536C318DFBBEA28A6516F948D5F98E815C42777D4F40376651C02F12A9780844121031403AF321F44BB0703A5BAD7DE32F2852366EB626E214ACF8330E1A82FF7D221FFFFFF000138E0F505000000001976A9144ED7C3BC56050B4B2755A88306BD842C2F6D86E388AC0000000001000000016100C585A59D6CDCB5E3187108913BA7F61B50EAAC195FB756F1AEF54E417554000000006B48304502210086517DBFCEBA06BE67657794E676CFCA5BAC4C893E3816EFF075CC8CD01D999002206F6326637F8E0C89E3E821469597BEB095E6009E67DF9E1C46630F41BA2424D8412102B8D1F5DCCDCC8318AF1DA8256844C07911B4464DAA172E52F2BB0DF8D2ED7F7EFFFFFFFF01F1190000000000001976A9146324233302940AE84D3CCE9690ED74E469A13AC188AC00000000020000000BCFE9987C5BC562F770752071A9724E39F269E139872E699D944324A70D8AF017000000006A47304402206D25437C947B6AE5A79A2806704075B67102D82EE600BD01C3566D21560D7611022048B4A77FFCF979535FF7461B82113B5D2931E857CA550135598C5513969003484121025CBD9248F3B8EC01B35AE317882F8EA20576CF1152606A28C9C71E03942EE0EDFEFFFFFFB2B277DB636B7563B4AE43392F5AAFEC5F1DA51B058C29AEC6692734B2460109000000006A47304402202474ACAA85B3AEA46DEE204F80981A8E7F9517F0DDD72609207CBEDA848F65D2022054AECC8D74A0B944A0CCA3915148916F1813E2E6C7E0351DC1E7D0D6F4FA4F69412102BD49D5CEF60F2F91575ADA036A1FE93A6786D5A60BC028A5F09F1899B68C285BFEFFFFFF16E86EA3AD0CA6C226D806984A210F002457CCEBC18AC3DA600DFAE52810FE4A000000006B483045022100A8EF6B1CD52941D64283D48A36748CAE82058860CDEC90F6F43FA8B6440E9EA602202E6F79B3F437D1925BE0AC6FF034A62503061C2040C8A3ADA4B4082752E166784121032BDFBA112DC7A0F1CA41227FB199D8232A459FF02BA491A37FA4E0F0DE1A34FCFEFFFFFF087F5197692CFD3A0F99C6344749CEE79866E94FA91C24DEDE16C1055DEFDF43000000006B48304502210096E6CCB0FFF827CA16BAD39E7D535B3B66DAAC4B26AB7E83B284F1791A775187022015756053AE64A93B8F3B2D186245071111055D69054FF2D38A0F947FA54ECFB441210389FC5AF2CA69332B40D57D10FFF9D0EB67C46EFF3C2C2BBC958504192FE40E9EFEFFFFFF50744C7A14346819B8119DE28EDFAD28385B2FD1ECABCCCBAC3CF3A8D958A038000000006B483045022100C610698DC173CAEDB3FC3C817796494DB137245823E62F6CAF200730D816238B02201E38881F2201513D7A9A2D4EEBE873D8ECC3E198B09DA07A696241EAF70247964121025CBD9248F3B8EC01B35AE317882F8EA20576CF1152606A28C9C71E03942EE0EDFEFFFFFF78812521CA356F9937C77B665D22DA11471FFEC7F0AE8430B984358565AAA804000000006B483045022100DC7139C561F638469E9DCAFA1693FE02BC86C77F899F329CD907A10B23A22691022018DF8FCD3017A474CB06581C1C6393ECD6256EBAA79D1A9999409AB2B87A1964412102BD52271B0D87B43098AFC7751EAD0B435CBABEB3F0308250EC2376C9899F6CFDFEFFFFFFF55DDA7CAEE1980A51487D998656D030632D366110A9DB2D0C4C8F3BCC3D25D7000000006A47304402204623D549CA06D145DAF3DA732E0F44BF7CA0EF235851576662831F64075EFD83022015CC1460ED711E0BE85855C706231C9D5FCE3B5FC69A6995ED0215C4D1B4434B412103141E8D8B633101879B8C4EDBDC728EC3359B0DC802C73BB75CF3345587A2BE09FEFFFFFFE6D3EA6535E43D8386C1E1B440A886EF6FD8219F1162D7B722B4021028788C0E000000006A47304402201C83729929FE47AB25B9976572AB7E16BF2ED1E69FAA7B77F65D36B9CD390ED502204F5333FB7A24E3D9C35615966583782BEFFC152AF7DB3F04E4C24E93DFE73BDC4121022A6C0F2D2E1CEF454CD61FC056204AB3ACA8F48C4DB0FF592B029FB83CD9FCAFFEFFFFFFCB61C8464C1004EA72185E144E0EFED213CF12B28841A10738CBA3E854B0B72D000000006B483045022100A2318AA87D89F1C4E6C7B0CC968E062F72033EB8E465554846A05E6F57C14391022071255661BD650CF25DB409CD918FF25CBFD88A7B87ED049D85B812CBBBD7BE61412102BD52271B0D87B43098AFC7751EAD0B435CBABEB3F0308250EC2376C9899F6CFDFEFFFFFF401CCC824F6FC4B601A582FC0B2F1C6E40ECF9D690633BBB112B27A836D160C4000000006A473044022028E08ED6A161F40CC8797BF6EF2916DB61278A6C8C1D09BD1BFB92B757F38F590220536B06F3DDDD38F1E9485405A181194BCF095A68A81487BE9C80654A1FC9A46C4121025CBD9248F3B8EC01B35AE317882F8EA20576CF1152606A28C9C71E03942EE0EDFEFFFFFF69BADF203442518F2A4A60C67927EF45A6B93F2B930A4079030C0E9D03AD8291010000006A47304402200A7E89AC65C3B0A37E4BD4B27141AE7A6B71A4ABADA54F4B6CBABD50244C25F002203CBA424502FF7E5D154BE7086B9752224008938C528B57E0735FF6BDEB28429C4121023329B4F576EEBA9DCFA178F68B8FEE345162C61BBCC634227BFAFD9B6507B769FEFFFFFF02A5D91002000000001976A91476C5AB3157164C2B80EA40977D158263FCBA85B488ACBF3C0F00000000001976A91409CF3B59902996A3FEEED53537DC20B6A00F084188ACA3D0080002000000026930EC2BD655E0AB7CA2014A4A128C81CA9EF7CE6CF71B6A145F32D82D23A3D7010000006A4730440220687534C45CF01FEB7281E6091B3156AD7ADE75A77F497F5B2BA1C2701CF2A7D002206FCB2F90C8CFEAB4674286FDC5E4904ECA2C05ACF836ED270805D15C3B6ACE5941210277D0B742B3F2B0EC4F1116B66816A8FC1106384D0177D09D9C3EAFC018080282FFFFFFFF2E62D66B20B4776697718FCDFE16695EC869A2E5383CFD8DDC0A23D1CEAA2D76020000006B483045022100DCFDC67978BCBB7CBEEAFBF559708D6FD9855BEA6BBA7716639E15D38B5C691B022079D59B8AE4BA3DA77D431DC0C9011599C5E72EB5479B5DE9D7EB550B2905E89141210357EF22684BA183A09F370ABA6910A3464FC72019F7E721531D3763177912438DFFFFFFFF0270C9FA02000000001976A9140026D2EF91E49190F0357E2EB7529BAA39BCC07288AC1C080939000000001976A914BA13F02E66AA5B274C812EE750B915BBCDE0A70988AC0000000001000000022DE3E6DDEF864B1EF1F04CC5D25C9E29D0EEEE5DDD7DDF21104EAA3FBCDFA448000000006B483045022100C7FCE0D8D60573AF5B59E562F3086881AA90CD760F3D9AFEACD5412304C6B2C9022077E479F716A0BA05F3C2CF5E93FF58E16053BA9AD916BC44833BD161F79F1D7F4121024483B9E8EBD84054BA8D6DE63D7434A92E9CCA7B4282869BEC16B945834BC4D6FFFFFFFF7AA0FE79405B409928CC832272C8663CC5499E867EB33357BA767F511EE1322E030000006A47304402207AECEAC0250F9107AF3F7330BECA8C5E7E1821CF61DF1DA71839F35FC1AABF4D02202AE90F3A1C3C3B5E85E95E0B5D4B16BC28D3E4A51149FEDC1E315101CAC77F9541210378B70629919BF88EA0CD86BC3371E590C4A60B4E26E0227C9BA4B7AEC3EAD31AFFFFFFFF0244840800000000001976A9141BEEF08136391B87EBC4DB37DED8A9B15C43119788AC3D6E4300000000001976A914016C4FF4D3E0643F386DE21525C2A587E393956C88AC000000000100000002032823AAE999E045058AEAF6F158A2CEA463C48F9C2F0DB248FF782E72F00189040000006A47304402206ACA1840A3B3B67F30AA855AE1E485E270242B4D09F0A047DAD5FCD4E10EECB102205A6888C9085D0B2AF2B54A5FEF7BA5ED97A4CFCBFE52B7411460FBCE21F434CB412102960E88E8C086CAFCEB03C2D19A2863F7E111901457CA8D2A38E4BF03B3C1AB4DFFFFFFFF2611B6AC946743AADAEEE6917ADF7FB2540F72B0C779FF7DDC0C9C29C730EE2A010000006B483045022100A4C465C48C8B9553A8AE881878452F3D80C6DA58DF4F8F79B502FC76E2270A310220743904C65050829B64FBD1EE78F91C1BDE4B6856E2A5316B831C43A101C75833412103DE5F9B893DC3926DA0FC9AD37C4A034BA586B7ECCF9D94B7ED655791D70795E6FFFFFFFF02BCD71405000000001976A9145EE8EDC815E0D3DEEA4177A1C44BA79D44589A0E88AC22020000000000001976A9140CAC8E0C8EED90163537A589333C48559C2C3D3288AC0000000001000000012F1B5E1C6F1446250D41A0AD4FDA0210B59D9EA94F4E99E5FF5939D1C2BE2672000000006A473044022039C926D7F54912267EE05A39E5E9D10D4DD1593DCCA0708894A927EA816E38390220395F789A98063AFB6C7B45F270B104240D1CDA05B75C74B33F9F2AE2540A251B41210270FD42949265B530B586A968E69E73AF902A0A5A1A39CEA580EEE3F62D252B48FFFFFFFF027E050000000000001976A914CE65509728192E98744B68E4F9C96A15A0C40A7688ACE06D2D00000000001976A914DAA492E29BE73E75F591044FF4892CF1DFD04F6688AC0000000002000000016A2C224469149B6FD37FAE241219FA9E142605F86F397F682656A1969E42D934010000006B4830450221009DB7001E08E6387F790547D0DC3D9FDDAADE731FF4C7442FED8BA22E20EBA2850220599642364E71EBDE2DDE71C20ECEA85A00EA3C3F38835B0A5C6ABD1864E03EA74121037FBF2C27BB172D29D178007F4B7FF0A9ECD396A83B3C0516BF0AF2D95E15FC68FEFFFFFF023AC9C700000000001976A914B71AFF4C9D2353A36758DAFB6CA61658C0CDA35188ACA8B49000000000001976A914776B878B416E3129310D3878D5E2941DC740B4A888AC8CD00800010000000279B76215F29341BB58D952A22C42B417A7D6BE7D534C996030DEC8B6BD6D8A98010000006B483045022100C85BB7A981F123863EDE50309C56DB137503472635D8CEDB95E4122AFE48E5CE02206670C6F4851B9A301EE9E6FEC19FA349B2603B1C203A5B3132C7F6C1F88559744121029B618129FEBDD4F5C8507A6152B22E3FD4480B1DD3F0315ADEBA0019BAE78571FFFFFFFF420EE5D70063A2F2998C188593AE917E8689EE566B7628AF71E9F7C6FA6132295B0000006A47304402202C17CE80E170030D42B7848DA2C8FA8E529AD6F68C84831A1D770DC6EC9D9F910220666E986DADF13F9B8CCF67AB7F961888DDA2AB182687F741E7CFB889916E26074121028BC0126C3E3319C6475A78F85B5BD6A515B598CB8FBA06849EEC8BF9E8CE18A7FFFFFFFF02D8100000000000001976A914FE525916891E9339DBFB1A1CC17214C0F7F1C7D088AC96445800000000001976A9142C068D9E6492DFD53AC9E067E99FC20498C3B0CD88AC00000000"));

        final BloomFilter bloomFilter = bloomFilterInflater.fromBytes(MutableByteArray.wrap(HexUtil.hexStringToByteArray("FD8A02F4106B35AB57512359874F141808577854B6F30A10325FACA7B6B435A2326A695008C670F5E6C484C2955EF99190516434C1744DE30822F55642A00C51F59F948B524D09E2B148E6FFDA219204739DE000A11D20026C8CA248B584A420F77E5B5FBDC858DD0520DF79055704B7FACA299CFDD0F0776BC4A6EFB01FF02D6F44A3D482224D318E43935281C7E8AC00A638B9360F2D6B763B069B1061A72A66C280F413BA34AC425D520839C6B09B4B6FA7BD47803DE82646089B0D49A934961222A25D631CEC6F6D57725695E036B4F912B7E7A494F6865501B9EC3CE02F025B03ED1A2DDC1975C27065A7795A369BFD069E4AFE4A612069599F3D95C15309C73105C889D4C36B83DE802394E5E0D2AAA0DB1180BE0491940F1761A8AB5CA366E2D58EAA7A7F412CEFD158FF308ACB4AE9940A53BD1C8C2A4D6CA162F30F3E9BD9D225334292821400C63D92A4E5E6B4E5280E10613714A5C008496928C6E8404E9C325FA214105E6B57248751B6367052CDD820461B27C4963951C3791FA218F302F35B2EA2BACE39CCCFEBC4C2BCC1908E38892AFC19790430475F5628C07ADF5F03B6D53CD3F14D9B3888736B77166EFC628A66D1C53A0EF881AF9B0F557616A2187AC6A008D2E4A50659861629826119C658B52CF0C0ED81D12769A5737DA892E820E19A9EBFC2C88238B04CE17FC29212B45F1AD269C599A6B1FAFFF1926A00199FE3DFC419D00B06186BC94171B121C2C1572CAB74B01C079479E4880A28FE28E4A5B92AD4ABB306638F68003D0604708A849174E6671423BCD9EC639498B1FEFBE7BC71C0DA9DA04939AC9730299B0C4971779261A5F84922C9A6C6C1EE5A18392D16D03408E1DB5C8800D72ECBAAD93B91152A112BD7C0A16E163A424E0775F91F1513A2EFDC240600000000F8375F02")));
        boolean bloomFilterContainedAddress = false;
        for (final Operation operation : ScriptBuilder.payToAddress("1111111111111111111114oLvT2").getOperations()) {
            if (operation.getType() == Operation.Type.OP_PUSH) {
                bloomFilterContainedAddress |= bloomFilter.containsItem(((PushOperation) operation).getValue());
            }
        }
        Assert.assertTrue(bloomFilterContainedAddress);

        final Sha256Hash transactionHash = Sha256Hash.fromHexString("9563D5F821649BA63AA7D828DD5720D497EDE81610512333CB67C4A8DFC3277E");

        boolean merkleTreeContainedMatchedTransaction = false;
        final PartialMerkleTree partialMerkleTree = block.getPartialMerkleTree(bloomFilter);
        for (final Sha256Hash hash : partialMerkleTree.getHashes()) {
            merkleTreeContainedMatchedTransaction |= Util.areEqual(transactionHash, hash);
        }
        Assert.assertTrue(merkleTreeContainedMatchedTransaction);
    }
}
